# MNIST 手写数字分类噪声（ CNN 模型）

这是一个基于卷积神经网络（CNN）对MNIST数据集进行训练，并评估其对标签噪声对精确度的影响的实验。通过引入不同类型的噪声（对称噪声和非对称噪声），我们可以分析噪声率对训练和测试准确率的影响。

## 目录

- [环境要求](#环境要求)
- [文件结构](#文件结构)
- [数据集](#数据集)
- [代码解释](#代码解释)
- [噪声类型](#噪声类型)
- [使用方法](使用方法)

## 环境要求

硬件：

- CPU：13th Gen Intel(R) Core(TM) i7-13700H   2.40 GHz
- GPU：NVIDIA GeForce RTX 4060 8GB
- RAM：32.0 GB

操作系统：

- Windows 11

语言环境：

- Python 3.9.20

库依赖：

- PyTorch 2.5.1+cu124
- torchvision 0.20.1+cu124
- matplotlib 3.9.3
- tqdm 4.67.1
- torchinfo 1.8.0

## 文件结构

```md
├── class									# 类的封装
│	├── CNNModel.py					          
│	├──Dataset.py				             
│	└──Plotter.py						     
├── data									# 数据集
│	└── MNIST
│		└── raw
│		    ├── t10k-images-idx3-ubyte
│		    ├── t10k-images-idx3-ubyte.gz
│		    ├── t10k-labels-idx1-ubyte
│		    ├── t10k-labels-idx1-ubyte.gz
│		    ├── train-images-idx3-ubyte
│		    ├── train-images-idx3-ubyte.gz
│		    ├── train-labels-idx1-ubyte
│		    └── train-labels-idx1-ubyte.gz	    
├── lab2_noise.ipynb						
├── lab2_noise.py
├── lab2-asymmetric.png					    # 非对称噪声
├── lab2-symmetry.png					    # 对称噪声
└── README.md             					# 实验的README文件
```

## 数据集

此项目使用的是MNIST数据集。该数据集包含60,000个训练图像和10,000个测试图像，主要用于手写数字识别。

### 数据加载

代码使用`torchvision.datasets.MNIST`从网上下载MNIST数据集。数据集的路径默认保存在`./data`目录中，您可以根据需要修改路径。



## 代码解释

### Dataset 类

`Dataset`类负责加载MNIST数据集并向其添加噪声。噪声添加的方式和比例由`noise_rate`和`noise_option`控制：

- `noise_rate`控制噪声的比例（0到1之间的小数，表示噪声标签的比例）。
- `noise_option`控制噪声的类型（1表示对称噪声，2表示非对称噪声）。

### CNNModel 类

`CNNModel`类是一个简单的卷积神经网络模型，包含两个卷积层和两个全连接层。模型使用ReLU激活函数，并通过最大池化减少图像尺寸。训练过程中使用交叉熵损失函数和Adam优化器。

### Plotter 类

`Plotter`类负责生成噪声率与准确率的绘图。使用渐变色显示训练准确率，右侧的折线图展示测试准确率。





## 噪声类型

本项目支持两种类型的标签噪声，用户可以在运行时选择：

- **对称噪声（Symmetric Noise）**：对标签进行随机替换，将每个标签替换为一个不同的随机标签。
- **非对称噪声（Asymmetric Noise）**：对标签进行非对称替换，将每个标签替换为其相邻的标签（例如，0变为1，1变为2，依此类推）。

噪声率通过`noise_rate`参数设置，控制标签噪声的程度。

## 使用方法

### 1. 数据预处理和噪声注入

在运行之前，你需要配置好数据加载和噪声的参数。修改`main.py`中的以下参数：

```python
batch = 64                 # 批大小
noise_rate = 0             # 标签噪声率 (0-1之间的小数，0表示无噪声)
root = './data'            # 数据集路径
transform = transforms.Compose([transforms.ToTensor(), transforms.Normalize((0.5,), (0.5,))]) # 数据预处理
epochs_num = 5             # 训练轮数
learning_rate = 0.001      # 学习率
noise_option = 1           # 噪声选项 (1: 对称噪声, 2: 非对称噪声)
```

### 2. 运行程序

运行`main.py`来开始训练和评估模型：

```bash
python lab2_noise.py
```

程序会按不同噪声率（从0%到100%，步长为10%）训练模型并评估其性能。每个噪声率对应的训练和测试准确率会被记录下来，并生成一个包含训练准确率和测试准确率的对比图。

### 3. 输出

程序会打印每个噪声率下的训练损失和准确率，同时显示测试准确率。训练和测试准确率的图表会使用`matplotlib`和`seaborn`生成，展示噪声率与模型性能的关系。

#### 输出样例

Noise Rate: 0.0%
Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz
Failed to download (trying next):
HTTP Error 403: Forbidden

Downloading https://ossci-datasets.s3.amazonaws.com/mnist/train-images-idx3-ubyte.gz
Downloading https://ossci-datasets.s3.amazonaws.com/mnist/train-images-idx3-ubyte.gz to ./data\MNIST\raw\train-images-idx3-ubyte.gz
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9.91M/9.91M [00:03<00:00, 2.89MB/s]
Extracting ./data\MNIST\raw\train-images-idx3-ubyte.gz to ./data\MNIST\raw

Downloading http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz
Failed to download (trying next):
HTTP Error 403: Forbidden

Downloading https://ossci-datasets.s3.amazonaws.com/mnist/train-labels-idx1-ubyte.gz
Downloading https://ossci-datasets.s3.amazonaws.com/mnist/train-labels-idx1-ubyte.gz to ./data\MNIST\raw\train-labels-idx1-ubyte.gz
100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 28.9k/28.9k [00:00<00:00, 130kB/s]
Extracting ./data\MNIST\raw\train-labels-idx1-ubyte.gz to ./data\MNIST\raw

Downloading http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz
Failed to download (trying next):
HTTP Error 403: Forbidden

Downloading https://ossci-datasets.s3.amazonaws.com/mnist/t10k-images-idx3-ubyte.gz
Downloading https://ossci-datasets.s3.amazonaws.com/mnist/t10k-images-idx3-ubyte.gz to ./data\MNIST\raw\t10k-images-idx3-ubyte.gz
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1.65M/1.65M [00:01<00:00, 1.17MB/s]
Extracting ./data\MNIST\raw\t10k-images-idx3-ubyte.gz to ./data\MNIST\raw

Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz
Failed to download (trying next):
HTTP Error 403: Forbidden

Downloading https://ossci-datasets.s3.amazonaws.com/mnist/t10k-labels-idx1-ubyte.gz
Downloading https://ossci-datasets.s3.amazonaws.com/mnist/t10k-labels-idx1-ubyte.gz to ./data\MNIST\raw\t10k-labels-idx1-ubyte.gz
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4.54k/4.54k [00:00<00:00, 3.46MB/s]
Extracting ./data\MNIST\raw\t10k-labels-idx1-ubyte.gz to ./data\MNIST\raw

Epoch 1/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:07<00:00, 120.96batch/s]
Epoch 1/5, Loss: 0.1573, Accuracy: 95.23%
Epoch 2/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 106.47batch/s] 
Epoch 2/5, Loss: 0.0475, Accuracy: 98.51%
Epoch 3/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:07<00:00, 121.10batch/s] 
Epoch 3/5, Loss: 0.0318, Accuracy: 99.02%
Epoch 4/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 104.51batch/s] 
Epoch 4/5, Loss: 0.0249, Accuracy: 99.23%
Epoch 5/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 100.22batch/s] 
Epoch 5/5, Loss: 0.0196, Accuracy: 99.39%

Test: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 157/157 [00:01<00:00, 142.18batch/s] 
Test Accuracy: 99.07%

Noise Rate: 10.0%
Epoch 1/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 102.05batch/s]
Epoch 1/5, Loss: 0.5428, Accuracy: 85.07%
Epoch 2/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 101.28batch/s] 
Epoch 2/5, Loss: 0.3919, Accuracy: 88.61%
Epoch 3/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 101.21batch/s] 
Epoch 3/5, Loss: 0.3691, Accuracy: 89.05%
Epoch 4/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 101.26batch/s] 
Epoch 4/5, Loss: 0.3546, Accuracy: 89.31%
Epoch 5/5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 99.67batch/s] 
Epoch 5/5, Loss: 0.3443, Accuracy: 89.49%

Test: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 157/157 [00:01<00:00, 140.04batch/s] 
Test Accuracy: 98.8%

Noise Rate: 20.0%
Epoch 1/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 100.62batch/s]
Epoch 1/5, Loss: 0.7086, Accuracy: 75.13%
Epoch 2/5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 99.36batch/s] 
Epoch 2/5, Loss: 0.5630, Accuracy: 78.70%
Epoch 3/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 105.78batch/s] 
Epoch 3/5, Loss: 0.5409, Accuracy: 79.16%
Epoch 4/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 104.71batch/s] 
Epoch 4/5, Loss: 0.5278, Accuracy: 79.34%
Epoch 5/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 104.90batch/s] 
Epoch 5/5, Loss: 0.5154, Accuracy: 79.64%

Test: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 157/157 [00:01<00:00, 143.31batch/s] 
Test Accuracy: 98.29%

Noise Rate: 30.0%
Epoch 1/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 103.41batch/s]
Epoch 1/5, Loss: 0.8544, Accuracy: 63.38%
Epoch 2/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 104.34batch/s] 
Epoch 2/5, Loss: 0.6809, Accuracy: 68.01%
Epoch 3/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 105.10batch/s] 
Epoch 3/5, Loss: 0.6581, Accuracy: 68.92%
Epoch 4/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 104.28batch/s] 
Epoch 4/5, Loss: 0.6419, Accuracy: 69.12%
Epoch 5/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:07<00:00, 117.72batch/s] 
Epoch 5/5, Loss: 0.6311, Accuracy: 69.47%

Test: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 157/157 [00:00<00:00, 169.60batch/s] 
Test Accuracy: 97.46%

Noise Rate: 40.0%
Epoch 1/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 113.98batch/s]
Epoch 1/5, Loss: 0.8964, Accuracy: 52.78%
Epoch 2/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 103.01batch/s] 
Epoch 2/5, Loss: 0.7384, Accuracy: 56.78%
Epoch 3/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 102.38batch/s] 
Epoch 3/5, Loss: 0.7150, Accuracy: 58.01%
Epoch 4/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 101.39batch/s] 
Epoch 4/5, Loss: 0.7020, Accuracy: 58.69%
Epoch 5/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:07<00:00, 121.23batch/s] 
Epoch 5/5, Loss: 0.6892, Accuracy: 59.68%

Test: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 157/157 [00:01<00:00, 145.80batch/s] 
Test Accuracy: 81.96%

Noise Rate: 50.0%
Epoch 1/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 104.17batch/s]
Epoch 1/5, Loss: 0.9213, Accuracy: 47.88%
Epoch 2/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 103.51batch/s]
Epoch 2/5, Loss: 0.7585, Accuracy: 50.50%
Epoch 3/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 101.10batch/s] 
Epoch 3/5, Loss: 0.7374, Accuracy: 51.11%
Epoch 4/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 104.42batch/s] 
Epoch 4/5, Loss: 0.7238, Accuracy: 52.13%
Epoch 5/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:07<00:00, 128.19batch/s] 
Epoch 5/5, Loss: 0.7127, Accuracy: 53.15%

Test: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 157/157 [00:01<00:00, 150.02batch/s] 
Test Accuracy: 46.81%

Noise Rate: 60.0%
Epoch 1/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 104.61batch/s]
Epoch 1/5, Loss: 0.9214, Accuracy: 52.30%
Epoch 2/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 108.05batch/s] 
Epoch 2/5, Loss: 0.7443, Accuracy: 56.72%
Epoch 3/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 106.32batch/s]
Epoch 3/5, Loss: 0.7189, Accuracy: 57.94%
Epoch 4/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 107.32batch/s] 
Epoch 4/5, Loss: 0.7049, Accuracy: 58.51%
Epoch 5/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 107.65batch/s] 
Epoch 5/5, Loss: 0.6944, Accuracy: 59.25%

Test: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 157/157 [00:01<00:00, 144.75batch/s] 
Test Accuracy: 12.35%

Noise Rate: 70.0%
Epoch 1/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 104.96batch/s]
Epoch 1/5, Loss: 0.8494, Accuracy: 63.24%
Epoch 2/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 104.93batch/s] 
Epoch 2/5, Loss: 0.6804, Accuracy: 68.05%
Epoch 3/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 104.34batch/s] 
Epoch 3/5, Loss: 0.6579, Accuracy: 68.80%
Epoch 4/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 104.60batch/s] 
Epoch 4/5, Loss: 0.6446, Accuracy: 69.14%
Epoch 5/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 105.88batch/s] 
Epoch 5/5, Loss: 0.6330, Accuracy: 69.41%

Test: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 157/157 [00:01<00:00, 145.38batch/s] 
Test Accuracy: 1.58%

Noise Rate: 80.0%
Epoch 1/5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:09<00:00, 99.22batch/s]
Epoch 1/5, Loss: 0.7330, Accuracy: 74.30%
Epoch 2/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 116.12batch/s] 
Epoch 2/5, Loss: 0.5712, Accuracy: 78.47%
Epoch 3/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 109.28batch/s] 
Epoch 3/5, Loss: 0.5469, Accuracy: 78.93%
Epoch 4/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 106.91batch/s] 
Epoch 4/5, Loss: 0.5331, Accuracy: 79.25%
Epoch 5/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 106.52batch/s] 
Epoch 5/5, Loss: 0.5197, Accuracy: 79.48%

Test: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 157/157 [00:01<00:00, 145.56batch/s] 
Test Accuracy: 0.72%

Noise Rate: 90.0%
Epoch 1/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 107.10batch/s]
Epoch 1/5, Loss: 0.5486, Accuracy: 84.92%
Epoch 2/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 106.75batch/s] 
Epoch 2/5, Loss: 0.3938, Accuracy: 88.51%
Epoch 3/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 107.06batch/s] 
Epoch 3/5, Loss: 0.3688, Accuracy: 89.04%
Epoch 4/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 106.97batch/s] 
Epoch 4/5, Loss: 0.3557, Accuracy: 89.28%
Epoch 5/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 107.31batch/s] 
Epoch 5/5, Loss: 0.3446, Accuracy: 89.47%

Test: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 157/157 [00:01<00:00, 152.44batch/s] 
Test Accuracy: 0.46%

Noise Rate: 100.0%
Epoch 1/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:07<00:00, 126.20batch/s]
Epoch 1/5, Loss: 0.1609, Accuracy: 95.10%
Epoch 2/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 108.30batch/s] 
Epoch 2/5, Loss: 0.0476, Accuracy: 98.55%
Epoch 3/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 107.58batch/s] 
Epoch 3/5, Loss: 0.0321, Accuracy: 98.99%
Epoch 4/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:08<00:00, 108.39batch/s] 
Epoch 4/5, Loss: 0.0246, Accuracy: 99.21%
Epoch 5/5: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 938/938 [00:07<00:00, 132.15batch/s] 
Epoch 5/5, Loss: 0.0165, Accuracy: 99.45%

Test: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 157/157 [00:00<00:00, 158.26batch/s] 
Test Accuracy: 0.14%



![image-20241209213059407](C:/Users/21574/AppData/Roaming/Typora/typora-user-images/image-20241209213059407.png)

![image-20241209213106064](C:/Users/21574/AppData/Roaming/Typora/typora-user-images/image-20241209213106064.png)